<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kuangshan.riskcontrol.dao.OnlineEduTimeTMapper">
  <resultMap id="BaseResultMap" type="com.kuangshan.riskcontrol.model.OnlineEduTimeT">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 18 19:20:14 CST 2020.
    -->
    <id column="online_edu_time_id" jdbcType="INTEGER" property="online_edu_time_id" />
    <result column="employee_num" jdbcType="VARCHAR" property="employee_num" />
    <result column="education_id" jdbcType="VARCHAR" property="education_id" />
    <result column="education_name" jdbcType="NVARCHAR" property="education_name" />
    <result column="online_edu_res_id" jdbcType="INTEGER" property="online_edu_res_id" />
    <result column="upload_file_name" jdbcType="VARCHAR" property="upload_file_name" />
    <result column="study_date" jdbcType="TIMESTAMP" property="study_date" />
    <result column="total_time" jdbcType="INTEGER" property="total_time" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 18 19:20:14 CST 2020.
    -->
    online_edu_time_id, employee_num, education_id, education_name, online_edu_res_id, 
    upload_file_name, study_date, total_time
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 18 19:20:14 CST 2020.
    -->
    select 
    <include refid="Base_Column_List" />
    from online_edu_time_t
    where online_edu_time_id = #{online_edu_time_id,jdbcType=INTEGER}
  </select>
  <select id="getCultivateInfo" resultType="java.util.Map">
SELECT education_id,education_name
FROM education_info_t
WHERE online_edu_res_idset
like CONCAT('%',#{resID},'%')

  </select>
  <select id="hasRecord" resultType="java.lang.Integer">
SELECT count(*) as count
FROM online_edu_time_t
WHERE upload_file_name = #{upload_file_name}
and online_edu_res_id = #{resId}
  </select>
    <select id="getCultivateNowPoint" resultType="java.util.Map">
      SELECT c.* FROM
(SELECT b.education_name as title,SUM(a.content_credit) as grad
FROM resource_content_t a,
(
SELECT c.upload_file_name,c.online_edu_res_id,c.education_name
	FROM online_edu_time_t c,resource_content_t d
	WHERE c.total_time >= d.min_learning_time
	AND c.upload_file_name = d.upload_file_name
    AND c.online_edu_res_id = d.edu_resource_id
	and c.employee_num = #{userID}
	and c.education_name !=' '
) b
WHERE a.upload_file_name = b.upload_file_name
    and a.edu_resource_id = b.online_edu_res_id
GROUP BY b.education_name) c
LEFT JOIN education_info_t
on c.title = education_info_t.education_name
ORDER BY start_time desc
    </select>
  <select id="getCultivateTotalPoint" resultType="java.lang.Integer">
    SELECT isnull(sum(b.content_credit),0) as total
FROM resource_content_t b
WHERE charindex(','+ltrim(b.edu_resource_id)+',',','+(SELECT a.online_edu_res_idset
FROM education_info_t a
WHERE a.education_name like #{educationName}) +',')>0
  </select>
  <select id="getSelfStudyPoint" resultType="java.util.Map">
SELECT b.online_edu_res_id,SUM(a.content_credit) as grad,b.resource_name as title,b.resource_credit as totalGrad
FROM resource_content_t a,
(
SELECT c.upload_file_name,c.online_edu_res_id,e.resource_name,e.resource_credit,e.upload_time
	FROM online_edu_time_t c,resource_content_t d,education_resource_t e
	WHERE c.total_time >= d.min_learning_time
	AND c.upload_file_name = d.upload_file_name
  AND c.online_edu_res_id = d.edu_resource_id
	and c.employee_num = #{userID}
	and e.edu_resource_id=c.online_edu_res_id
	and c.education_id is NULL

) b
WHERE a.upload_file_name = b.upload_file_name
    and a.edu_resource_id = b.online_edu_res_id
GROUP BY b.online_edu_res_id,b.resource_name,b.resource_credit,b.upload_time
ORDER BY b.upload_time desc


  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 18 19:20:14 CST 2020.
    -->
    delete from online_edu_time_t
    where online_edu_time_id = #{online_edu_time_id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.kuangshan.riskcontrol.model.OnlineEduTimeT">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 18 19:20:14 CST 2020.
    -->
    insert into online_edu_time_t (online_edu_time_id, employee_num, 
      education_id, education_name, online_edu_res_id, 
      upload_file_name, study_date, total_time
      )
    values (#{online_edu_time_id,jdbcType=INTEGER}, #{employee_num,jdbcType=VARCHAR}, 
      #{education_id,jdbcType=VARCHAR}, #{education_name,jdbcType=NVARCHAR}, #{online_edu_res_id,jdbcType=INTEGER}, 
      #{upload_file_name,jdbcType=VARCHAR}, #{study_date,jdbcType=TIMESTAMP}, #{total_time,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.kuangshan.riskcontrol.model.OnlineEduTimeT"
          useGeneratedKeys="true" keyProperty="online_edu_time_id">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 18 19:20:14 CST 2020.
    -->
    insert into online_edu_time_t
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="online_edu_time_id != null">
        online_edu_time_id,
      </if>
      <if test="employee_num != null">
        employee_num,
      </if>
      <if test="education_id != null">
        education_id,
      </if>
      <if test="education_name != null">
        education_name,
      </if>
      <if test="online_edu_res_id != null">
        online_edu_res_id,
      </if>
      <if test="upload_file_name != null">
        upload_file_name,
      </if>
      <if test="study_date != null">
        study_date,
      </if>
      <if test="total_time != null">
        total_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="online_edu_time_id != null">
        #{online_edu_time_id,jdbcType=INTEGER},
      </if>
      <if test="employee_num != null">
        #{employee_num,jdbcType=VARCHAR},
      </if>
      <if test="education_id != null">
        #{education_id,jdbcType=VARCHAR},
      </if>
      <if test="education_name != null">
        #{education_name,jdbcType=NVARCHAR},
      </if>
      <if test="online_edu_res_id != null">
        #{online_edu_res_id,jdbcType=INTEGER},
      </if>
      <if test="upload_file_name != null">
        #{upload_file_name,jdbcType=VARCHAR},
      </if>
      <if test="study_date != null">
        #{study_date,jdbcType=TIMESTAMP},
      </if>
      <if test="total_time != null">
        #{total_time,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.kuangshan.riskcontrol.model.OnlineEduTimeT">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 18 19:20:14 CST 2020.
    -->
    update online_edu_time_t
    <set>
      <if test="employee_num != null">
        employee_num = #{employee_num,jdbcType=VARCHAR},
      </if>
      <if test="education_id != null">
        education_id = #{education_id,jdbcType=VARCHAR},
      </if>
      <if test="education_name != null">
        education_name = #{education_name,jdbcType=NVARCHAR},
      </if>
      <if test="online_edu_res_id != null">
        online_edu_res_id = #{online_edu_res_id,jdbcType=INTEGER},
      </if>
      <if test="upload_file_name != null">
        upload_file_name = #{upload_file_name,jdbcType=VARCHAR},
      </if>
      <if test="study_date != null">
        study_date = #{study_date,jdbcType=TIMESTAMP},
      </if>
      <if test="total_time != null">
        total_time = #{total_time,jdbcType=INTEGER},
      </if>
    </set>
    where online_edu_time_id = #{online_edu_time_id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.kuangshan.riskcontrol.model.OnlineEduTimeT">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 18 19:20:14 CST 2020.
    -->
    update online_edu_time_t
    set employee_num = #{employee_num,jdbcType=VARCHAR},
      education_id = #{education_id,jdbcType=VARCHAR},
      education_name = #{education_name,jdbcType=NVARCHAR},
      online_edu_res_id = #{online_edu_res_id,jdbcType=INTEGER},
      upload_file_name = #{upload_file_name,jdbcType=VARCHAR},
      study_date = #{study_date,jdbcType=TIMESTAMP},
      total_time = #{total_time,jdbcType=INTEGER}
    where online_edu_time_id = #{online_edu_time_id,jdbcType=INTEGER}
  </update>
  <update id="updateTotalTIme">
    UPDATE online_edu_time_t
SET total_time += #{total_time}
WHERE upload_file_name = #{upload_file_name}

  </update>
</mapper>
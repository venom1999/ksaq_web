(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6d98c2b6"],{"268f":function(e,t,i){e.exports=i("fde4")},"2cdc":function(e,t,i){"use strict";var n=i("2b0e");t["a"]=new n["default"]},"2f21":function(e,t,i){"use strict";var n=i("79e5");e.exports=function(e,t){return!!e&&n(function(){t?e.call(null,function(){},1):e.call(null)})}},"2f6b":function(e,t,i){"use strict";var n=i("c67c"),a=i.n(n);a.a},"32a6":function(e,t,i){var n=i("241e"),a=i("c3a1");i("ce7e")("keys",function(){return function(e){return a(n(e))}})},"454f":function(e,t,i){i("46a7");var n=i("584a").Object;e.exports=function(e,t,i){return n.defineProperty(e,t,i)}},"46a7":function(e,t,i){var n=i("63b6");n(n.S+n.F*!i("8e60"),"Object",{defineProperty:i("d9f6").f})},"55dd":function(e,t,i){"use strict";var n=i("5ca1"),a=i("d8e8"),o=i("4bf8"),r=i("79e5"),s=[].sort,l=[1,2,3];n(n.P+n.F*(r(function(){l.sort(void 0)})||!r(function(){l.sort(null)})||!i("2f21")(s)),"Array",{sort:function(e){return void 0===e?s.call(o(this)):s.call(o(this),a(e))}})},"5df3":function(e,t,i){"use strict";var n=i("02f4")(!0);i("01f9")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,i=this._i;return i>=t.length?{value:void 0,done:!0}:(e=n(t,i),this._i+=e.length,{value:e,done:!1})})},"671f":function(e,t,i){},"83f0":function(e,t,i){},8406:function(e,t,i){},"85f2":function(e,t,i){e.exports=i("454f")},"8aae":function(e,t,i){i("32a6"),e.exports=i("584a").Object.keys},"8b59":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-container",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[i("el-header",{attrs:{height:"48px"}},[i("el-breadcrumb",{attrs:{separator:"/"}},[i("el-breadcrumb-item",[e._v("单元划分")])],1)],1),i("div",{staticClass:"wrapper"},[i("div",{staticClass:"content"},[i("div",{staticClass:"section"},[i("div",{staticClass:"list-operation"},[i("el-button",{attrs:{type:"primary"},on:{click:e.showDetailAll}},[e._v("单元划分详细信息")]),i("el-button",{attrs:{type:"primary"},on:{click:e.exportAll}},[e._v("单元导出")]),e.copyRight?i("el-button",{attrs:{type:"primary"},on:{click:e.addAllFromInstitutions}},[e._v("单元初始化")]):e._e(),e.copyRight?i("el-button",{attrs:{type:"primary"},on:{click:e.showCopy}},[e._v("单元复制")]):e._e(),e.copyRight?i("el-button",{attrs:{type:"primary"},on:{click:e.archiveAll}},[e._v("单元全部归档")]):e._e()],1)]),i("div",{staticClass:"section"},[i("el-input",{staticClass:"tree-filter",attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterTreeText,callback:function(t){e.filterTreeText=t},expression:"filterTreeText"}})],1),i("div",{staticClass:"section"},[i("el-tree",{ref:"tree",attrs:{"filter-node-method":e.filterNode,"node-key":"id",indent:"0","expand-on-click-node":!0,"highlight-current":""},on:{"node-click":e.nodeLeftClickToHide,"node-contextmenu":e.nodeRightClick},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node;return i("span",{staticClass:"custom-tree-node"},[i("span",[e._v(e._s(n.label))])])}}])})],1)])])],1),i("div",{staticClass:"pop-dialog"},[i("section-add"),i("activity-add"),i("section-edit"),i("activity-edit"),i("all-detail"),i("section-copy"),i("section-detail"),i("activity-detail")],1),i("right-click-menu",{attrs:{"user-right-editable":e.userRightEditable}})],1)},a=[],o=(i("ac6a"),i("5df3"),i("cebc")),r=(i("c5f6"),i("d257")),s=i("2cdc"),l=i("3a0b"),c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"right-click-menu"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.visible.section,expression:"visible.section"}],staticClass:"section-menu"},[i("ul",{staticClass:"el-dropdown-menu el-popper",staticStyle:{position:"absolute","transform-origin":"center top","z-index":"2100"},attrs:{"x-placement":"bottom-end"}},[e.userRightEditable&&e.canAddPeer?i("li",{staticClass:"el-dropdown-menu__item operation-editable",attrs:{tabindex:"-1"},on:{click:function(t){return e.handleMenuItemClicked("add-peer")}}},[i("i",{staticClass:"el-icon-circle-plus"}),e._v("添加同级\n        ")]):e._e(),e.userRightEditable&&e.editable&&!e.noData?i("li",{staticClass:"el-dropdown-menu__item operation-editable",attrs:{tabindex:"-1"},on:{click:function(t){return e.handleMenuItemClicked("add-child")}}},[i("i",{staticClass:"el-icon-plus"}),e._v("添加下级\n        ")]):e._e(),e.noData?e._e():i("li",{staticClass:"el-dropdown-menu__item",attrs:{tabindex:"-1"},on:{click:function(t){return e.handleMenuItemClicked("detail")}}},[i("i",{staticClass:"el-icon-info"}),e._v("详细\n        ")]),e.userRightEditable&&e.editable&&!e.noData?i("li",{staticClass:"el-dropdown-menu__item operation-editable",attrs:{tabindex:"-1"},on:{click:function(t){return e.handleMenuItemClicked("edit")}}},[i("i",{staticClass:"el-icon-edit"}),e._v("修改\n        ")]):e._e(),e.userRightEditable&&e.editable&&!e.noData?i("li",{staticClass:"el-dropdown-menu__item operation-editable",attrs:{tabindex:"-1"},on:{click:function(t){return e.handleMenuItemClicked("delete")}}},[i("i",{staticClass:"el-icon-delete"}),e._v("删除\n        ")]):e._e()])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.visible.activity,expression:"visible.activity"}],staticClass:"activity-menu"},[i("ul",{staticClass:"el-dropdown-menu el-popper",staticStyle:{position:"absolute","transform-origin":"center top","z-index":"2100"},attrs:{"x-placement":"bottom-end"}},[e.userRightEditable&&e.editable?i("li",{staticClass:"el-dropdown-menu__item",attrs:{tabindex:"-1"},on:{click:function(t){return e.handleMenuItemClicked("add-peer")}}},[i("i",{staticClass:"el-icon-circle-plus"}),e._v("添加\n        ")]):e._e(),i("li",{staticClass:"el-dropdown-menu__item",attrs:{tabindex:"-1"},on:{click:function(t){return e.handleMenuItemClicked("detail")}}},[i("i",{staticClass:"el-icon-info"}),e._v("详细\n        ")]),e.userRightEditable&&e.editable?i("li",{staticClass:"el-dropdown-menu__item",attrs:{tabindex:"-1"},on:{click:function(t){return e.handleMenuItemClicked("edit")}}},[i("i",{staticClass:"el-icon-edit"}),e._v("修改\n        ")]):e._e(),e.userRightEditable&&e.editable?i("li",{staticClass:"el-dropdown-menu__item",attrs:{tabindex:"-1"},on:{click:function(t){return e.handleMenuItemClicked("delete")}}},[i("i",{staticClass:"el-icon-delete"}),e._v("删除\n        ")]):e._e()])])])},d=[],u=i("1157"),m=i.n(u),f=i("2f62"),p={name:"RightClickMenu",props:["userRightEditable"],data:function(){return{visible:{section:!1,activity:!1},editable:!0,level:0,noData:!1,canAddPeer:!1}},watch:{visible:function(e){}},computed:Object(o["a"])({},Object(f["b"])(["user"])),methods:{checkAuth:function(e,t){if(r["g"].indexOf(this.user.inst1)>-1)return!0;var i=t,n=this.user.inst2;return i&&n?e===this.user.inst2&&t===this.user.inst1:i&&!n?e===this.user.inst1:!(!i&&n)&&(i||n?void 0:e===this.user.inst1)},handleMenuItemClicked:function(e){var t=this,i=function(e){return e<=t.$parent.postLevel?"section":"activity"};-1!==["add-peer","add-child"].indexOf(e)?s["a"].$emit("show-add-".concat(i("add-peer"===e?this.$parent.clickedNode.level:this.$parent.clickedNode.level+1)),e):-1!==["delete","archive"].indexOf(e)?s["a"].$emit("".concat(e,"-node")):s["a"].$emit("show-".concat(e,"-").concat(i(this.$parent.clickedNode.level)))},checkAddPeer:function(e,t){if(r["g"].indexOf(this.user.inst1)>-1)return!0;var i=t,n=this.user.inst2;return i&&n?t===this.user.inst1:i&&!n?e===this.user.inst1:!(!i&&n)&&(!i&&!n||void 0)}},created:function(){var e=this;s["a"].$on("show-menu",function(t){e.noData="0"===e.$parent.clickedNode.data.id,e.visible[t.type]=!0,e.level=t.level;var i,n,a=e.$parent.clickedNode;4===a.level&&(a=a.parent),3===a.level&&(a=a.parent),2===a.level&&(n=a.data.sectionNum,a=a.parent),i=a.data.sectionNum,e.canAddPeer=e.checkAddPeer(i,n),e.editable=e.checkAuth(i,n),e.$nextTick(function(){var e=m()(".".concat(t.type,"-menu>ul"));t.y/Math.max(document.body.scrollHeight,window.outerHeight)<.7?e.css("top",t.y).css("left",t.x):e.css("top",t.y-e[0].offsetHeight).css("left",t.x)})}),s["a"].$on("hide-menu",function(){e.visible={section:!1,activity:!1}})}},v=p,h=(i("a594"),i("2877")),b=Object(h["a"])(v,c,d,!1,null,"116a6e12",null),g=b.exports,N=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"dialog-add-section"},[i("el-dialog",{attrs:{title:"添加单元信息",visible:e.visible,modal:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",attrs:{model:e.record,rules:e.rules}},[e._l(e.parentSections,function(t,n){return i("el-form-item",{key:n,attrs:{label:["分公司","班组","岗位"][n]+"单元名称："}},[i("el-input",{attrs:{value:e.parentSection[t],readonly:""}})],1)}),e.$parent.clickedNode&&e.parentNode.level+1<e.postLevel?i("el-form-item",{attrs:{label:"对应机构：",prop:"sectionNum"}},[i("el-select",{attrs:{filterable:""},on:{change:e.setSectionName},model:{value:e.record.sectionNum,callback:function(t){e.$set(e.record,"sectionNum",t)},expression:"record.sectionNum"}},e._l(e.sectionInst,function(e,t){return i("el-option",{key:t,attrs:{value:e.InstitutionNum,label:e.InstitutionName}})}),1)],1):e._e(),i("el-form-item",{attrs:{label:e.getSectionLabel()+"单元名称",prop:"sectionName"}},[i("el-input",{attrs:{clearable:""},model:{value:e.record.sectionName,callback:function(t){e.$set(e.record,"sectionName",t)},expression:"record.sectionName"}})],1),e.$parent.clickedNode&&e.parentNode.level===e.postLevel-1?i("el-form-item",{attrs:{label:"岗位单元编号：",prop:"sectionNum"}},[i("el-input",{attrs:{clearable:""},model:{value:e.record.sectionNum,callback:function(t){e.$set(e.record,"sectionNum",t)},expression:"record.sectionNum"}})],1):e._e(),i("el-form-item",{attrs:{label:"创建日期：",prop:"createdTime"}},[i("el-date-picker",{attrs:{clearable:""},model:{value:e.record.createdTime,callback:function(t){e.$set(e.record,"createdTime",t)},expression:"record.createdTime"}})],1)],2),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{disabled:e.hasChanges,type:"primary"},on:{click:e.submit}},[e._v("添 加")]),i("el-button",{attrs:{disabled:e.hasChanges},on:{click:e.clearForm}},[e._v("重 置")]),i("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("关 闭")])],1)],1)],1)},_=[],k=(i("456d"),i("55dd"),{inject:["rules","getParentSection","postLevel"],computed:Object(o["a"])({},Object(f["b"])(["institutions","user"]),{parentSections:function(){return Object.keys(this.parentSection).filter(function(e){return-1!==e.indexOf("name")}).sort()},sectionInst:function(){var e=this;if(!this.parentNode)return this.institutions;var t=this.institutions,i=this.parentNode.childNodes.map(function(e){return e.data.sectionNum});return t=t.filter(function(e){return-1===i.indexOf(e.InstitutionNum)}),0===this.parentSections.length?(t=t.filter(function(e){return 4===e.InstitutionCategoryNum||"BWB"===e.InstitutionNum}),-1===r["g"].indexOf(this.user.inst1)&&(t=t.filter(function(t){return t.InstitutionNum===e.user.inst1}))):1===this.parentSections.length&&(t=t.filter(function(t){return 5===t.InstitutionCategoryNum&&t.InstitutionPrefix===e.parentNode.data.sectionNum}),-1===r["g"].indexOf(this.user.inst1)&&this.user.inst2&&(t=t.filter(function(t){return t.InstitutionNum===e.user.inst1}))),this.record.sectionNum&&-1===t.indexOf(this.record.sectionNum)&&t.push(this.institutions.filter(function(t){return t.InstitutionNum===e.record.sectionNum})[0]),t},parentNode:function(){var e=this.addType&&"add-child"===this.addType?this.$parent.clickedNode:this.$parent.clickedNode.parent;return e||{level:0,childNodes:[]}}}),data:function(){return{visible:!1,loading:!1,hasChanges:!1,parentSection:{},addType:null}},methods:{setSectionName:function(e){this.record.sectionNum=e,this.record.sectionName=this.sectionInst.filter(function(t){return e===t.InstitutionNum})[0].InstitutionName+"单元"},getSectionLabel:function(){return this.$parent.clickedNode&&this.parentNode?["分公司","班组","岗位",""][this.parentNode.level]:""}}}),y={name:"SectionAdd",mixins:[k],data:function(){return{record:{sectionName:null,sectionNum:null,createdTime:null}}},watch:{visible:function(e){var t=this;e||(this.hasChanges&&s["a"].$emit("add-node",{data:{label:this.record.sectionName,id:this.record.sectionID+"",sectionNum:this.record.sectionNum},parentKey:this.parentNode.data.id}),this.$refs.ruleForm.resetFields(),Object.keys(this.record).forEach(function(e){t.record[e]=null}))}},methods:{clearForm:function(){this.record.sectionNum="",this.record.sectionName="",this.record.createdTime=null},submit:function(){var e=this;this.$refs.ruleForm.validate(function(t){t&&(e.record.parentSection=Number(e.parentNode.data.id),e.loading=!0,r["c"].postJson(r["a"].SECTION_PARTITION+"/section",e.record,function(t){switch(e.loading=!1,t.status){case"ok":e.record.sectionID=t.id,e.hasChanges=!0,e.$message.success("提交成功"),e.visible=!1;break;case"conflicted":e.$message.error("岗位单元编号已存在");break}}))})}},created:function(){var e=this;s["a"].$on("show-add-section",function(t){e.hasChanges=!1,e.visible=!0,e.addType=t,e.parentSection=e.getParentSection(e.parentNode),e.record.createdTime=new Date})}},$=y,I=Object(h["a"])($,N,_,!1,null,"68249fea",null),w=I.exports,C=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"dialog-add-activity"},[i("el-dialog",{attrs:{title:"添加作业活动信息",visible:e.visible,modal:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",attrs:{model:e.record,rules:e.rules}},[e._l(e.parentSections,function(t,n){return i("el-form-item",{key:n,attrs:{label:["分公司","班组","岗位"][n]+"单元名称："}},[i("el-input",{attrs:{readonly:""},model:{value:e.parentSection[t],callback:function(i){e.$set(e.parentSection,t,i)},expression:"parentSection[item]"}})],1)}),i("el-form-item",{attrs:{label:"作业活动名称：",prop:"aename"}},[i("el-input",{attrs:{clearable:""},model:{value:e.record.aename,callback:function(t){e.$set(e.record,"aename",t)},expression:"record.aename"}})],1),i("el-form-item",{attrs:{label:"作业地点：",prop:"location"}},[i("el-input",{attrs:{clearable:""},model:{value:e.record.location,callback:function(t){e.$set(e.record,"location",t)},expression:"record.location"}})],1),i("el-form-item",{attrs:{label:"备注：",prop:"aememo"}},[i("el-input",{attrs:{clearable:""},model:{value:e.record.aememo,callback:function(t){e.$set(e.record,"aememo",t)},expression:"record.aememo"}})],1)],2),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{disabled:e.hasChanges,type:"primary"},on:{click:e.submit}},[e._v("添 加")]),i("el-button",{attrs:{disabled:e.hasChanges},on:{click:e.clearForm}},[e._v("重 置")]),i("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("关 闭")])],1)],1)],1)},x=[],T={name:"ActivityAdd",data:function(){return{record:{aename:null,aememo:null,location:null}}},mixins:[k],watch:{visible:function(e){e||(this.hasChanges&&s["a"].$emit("add-node",{data:{label:this.record.aename,id:"act-"+this.record.aeinfoID},parentKey:this.parentNode.data.id}),this.$refs.ruleForm.resetFields(),this.record={})}},methods:{clearForm:function(){this.record.aememo="",this.record.aename="",this.record.location=""},submit:function(){var e=this;this.$refs.ruleForm.validate(function(t){t&&(e.record.aefatherID=Number(e.parentNode.data.id),e.record.actOrEquip=0,e.loading=!0,r["c"].postJson(r["a"].SECTION_PARTITION+"/activity",e.record,function(t){e.loading=!1,"ok"===t.status&&(e.record.aeinfoID=t.id,e.hasChanges=!0,e.$message.success("提交成功"),e.visible=!1)}))})}},created:function(){var e=this;s["a"].$on("show-add-activity",function(t){e.hasChanges=!1,e.visible=!0,e.addType=t,e.parentSection=e.getParentSection(e.parentNode),e.record.createdTime=new Date})}},O=T,S=Object(h["a"])(O,C,x,!1,null,"12e1c827",null),D=S.exports,E=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"dialog-add-activity"},[i("el-dialog",{attrs:{title:"修改作业活动信息",visible:e.visible,modal:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",attrs:{model:e.record,rules:e.rules}},[e._l(e.parentSections,function(t,n){return i("el-form-item",{key:n,attrs:{label:["分公司","班组","岗位"][n]+"单元名称："}},[i("el-input",{attrs:{readonly:""},model:{value:e.parentSection[t],callback:function(i){e.$set(e.parentSection,t,i)},expression:"parentSection[item]"}})],1)}),i("el-form-item",{attrs:{label:"作业活动名称：",prop:"aename"}},[i("el-input",{attrs:{clearable:""},model:{value:e.record.aename,callback:function(t){e.$set(e.record,"aename",t)},expression:"record.aename"}})],1),i("el-form-item",{attrs:{label:"作业地点：",prop:"location"}},[i("el-input",{attrs:{clearable:""},model:{value:e.record.location,callback:function(t){e.$set(e.record,"location",t)},expression:"record.location"}})],1),i("el-form-item",{attrs:{label:"备注：",prop:"aememo"}},[i("el-input",{attrs:{clearable:""},model:{value:e.record.aememo,callback:function(t){e.$set(e.record,"aememo",t)},expression:"record.aememo"}})],1)],2),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{disabled:e.hasChanges,type:"primary"},on:{click:e.submit}},[e._v("保 存")]),i("el-button",{attrs:{disabled:e.hasChanges},on:{click:function(t){return e.$refs.ruleForm.resetFields()}}},[e._v("重 置")]),i("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("关 闭")])],1)],1)],1)},A=[],P={name:"ActivityEdit",data:function(){return{record:{aename:null,aememo:null,location:null}}},mixins:[k],watch:{visible:function(e){e||(this.hasChanges&&s["a"].$emit("edit-node",{label:this.record.aename,key:this.$parent.clickedNode.data.id}),this.$refs.ruleForm.resetFields(),this.record={})}},methods:{submit:function(){var e=this;this.$refs.ruleForm.validate(function(t){t&&(e.loading=!0,window.setTimeout(function(){e.loading&&(e.loading=!1,e.$message.error("数据传输错误"))},6e3),r["c"].putJson(r["a"].SECTION_PARTITION+"/activity",e.record,function(t){e.loading=!1,"ok"===t.status&&(e.record.aeinfoID=t.id,e.hasChanges=!0,e.$message.success("提交成功"))}))})}},created:function(){var e=this;s["a"].$on("show-edit-activity",function(){e.hasChanges=!1;var t=e.$parent.clickedNode.data.id;e.record.aeinfoID=Number(t.substring(t.indexOf("-")+1)),e.visible=!0,e.parentSection=e.getParentSection(e.$parent.clickedNode.parent),e.loading=!0,r["c"].get(r["a"].SECTION_PARTITION+"/activity/".concat(e.record.aeinfoID)).then(function(t){e.loading=!1,e.record=t.record||{}})})},mounted:function(){}},R=P,L=Object(h["a"])(R,E,A,!1,null,"3efe393f",null),F=L.exports,j=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"dialog-edit-section"},[i("el-dialog",{attrs:{title:"修改单元信息",visible:e.visible,modal:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",attrs:{model:e.record,rules:e.rules}},[e._l(e.parentSections,function(t,n){return i("el-form-item",{key:n,attrs:{label:["分公司","班组","岗位"][n]+"单元名称："}},[i("el-input",{attrs:{value:e.parentSection[t],readonly:""}})],1)}),e.$parent.clickedNode&&e.$parent.clickedNode.level<e.postLevel?i("el-form-item",{attrs:{label:"对应机构：",prop:"sectionNum"}},[i("el-select",{attrs:{filterable:""},on:{change:e.setSectionName},model:{value:e.record.sectionNum,callback:function(t){e.$set(e.record,"sectionNum",t)},expression:"record.sectionNum"}},e._l(e.sectionInst,function(e,t){return i("el-option",{key:t,attrs:{value:e.InstitutionNum,label:e.InstitutionName}})}),1)],1):e._e(),i("el-form-item",{attrs:{label:e.getSectionLabel()+"单元名称",prop:"sectionName"}},[i("el-input",{attrs:{clearable:""},model:{value:e.record.sectionName,callback:function(t){e.$set(e.record,"sectionName",t)},expression:"record.sectionName"}})],1),e.$parent.clickedNode&&e.parentNode.level===e.postLevel-1?i("el-form-item",{attrs:{label:"单元编号：",prop:"sectionNum"}},[i("el-input",{attrs:{clearable:""},model:{value:e.record.sectionNum,callback:function(t){e.$set(e.record,"sectionNum",t)},expression:"record.sectionNum"}})],1):e._e(),i("el-form-item",{attrs:{label:"创建日期：",prop:"createdTime"}},[i("el-date-picker",{attrs:{clearable:""},model:{value:e.record.createdTime,callback:function(t){e.$set(e.record,"createdTime",t)},expression:"record.createdTime"}})],1)],2),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{disabled:e.hasChanges,type:"primary"},on:{click:e.submit}},[e._v("保 存")]),i("el-button",{attrs:{disabled:e.hasChanges},on:{click:function(t){return e.$refs.ruleForm.resetFields()}}},[e._v("重 置")]),i("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("关 闭")])],1)],1)],1)},Y=[],M={name:"SectionEdit",data:function(){return{record:{sectionName:null,sectionNum:null,createdTime:null}}},mixins:[k],watch:{visible:function(e){var t=this;e||(this.hasChanges&&s["a"].$emit("edit-node",{label:this.record.sectionName,key:this.$parent.clickedNode.data.id}),this.$refs.ruleForm.resetFields(),Object.keys(this.record).forEach(function(e){t.record[e]=null}))}},methods:{submit:function(){var e=this;this.$refs.ruleForm.validate(function(t){t&&(e.loading=!0,window.setTimeout(function(){e.loading&&(e.loading=!1,e.$message.error("数据传输错误"))},6e3),r["c"].putJson(r["a"].SECTION_PARTITION+"/section",e.record,function(t){switch(e.loading=!1,t.status){case"ok":e.hasChanges=!0,e.$message.success("提交成功");break;case"conflicted":e.$message.error("岗位单元编号已存在");break}}))})}},created:function(){var e=this;s["a"].$on("show-edit-section",function(){e.parentSection=e.getParentSection(e.$parent.clickedNode.parent),e.record.sectionID=Number(e.$parent.clickedNode.data.id),e.hasChanges=!1,e.visible=!0,e.loading=!0,window.setTimeout(function(){e.loading&&(e.loading=!1,e.$message.error("数据传输错误"))},1e4),r["c"].get(r["a"].SECTION_PARTITION+"/section/".concat(e.record.sectionID),function(t){e.loading=!1,e.record=t.record||{}})})}},H=M,J=Object(h["a"])(H,j,Y,!1,null,"e852b91e",null),q=J.exports,z=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"detail-dialog-all"},[i("el-dialog",{attrs:{title:"查看单元划分信息",visible:e.visible,modal:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"list-table"},[i("table",[i("tbody",[i("tr",[i("th",{attrs:{width:"20%"}},[i("div",[i("span",[e._v("分公司")])])]),i("th",{attrs:{width:"20%"}},[i("div",[i("span",[e._v("班组")])])]),i("th",{attrs:{width:"35%"}},[i("div",[i("span",[e._v("岗位单元")])])]),i("th",{attrs:{width:"25%"}},[i("div",[i("span",[e._v("作业活动")])])])]),e._l(e.list,function(t,n){return i("tr",{key:n,attrs:{align:"center"}},[t.rowspan1&&t.rowspan1>0?i("td",{attrs:{rowspan:t.rowspan1,title:t.sectionName1}},[e._v("\n              "+e._s(t.sectionName1)+"\n            ")]):e._e(),t.rowspan2&&t.rowspan2>0?i("td",{attrs:{rowspan:t.rowspan2,title:t.sectionName2}},[e._v("\n              "+e._s(t.sectionName2)+"\n            ")]):e._e(),t.rowspan3&&t.rowspan3>0?i("td",{attrs:{rowspan:t.rowspan3,title:t.sectionName3?t.sectionName3+"("+t.sectionNum+")":""}},[e._v("\n              "+e._s(t.sectionName3?t.sectionName3+"("+t.sectionNum+")":"")+"\n            ")]):e._e(),t.rowspan5&&t.rowspan5>0?i("td",{attrs:{rowspan:t.rowspan5,title:t.AEName}},[e._v(e._s(t.AEName))]):e._e()])})],2)])]),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("关 闭")])],1)])],1)},K=[],B=i("ae03"),U={name:"AllDetail",data:function(){return{visible:!1,loading:!1,list:[]}},methods:{},mounted:function(){var e=this;s["a"].$on("show-detail-all",function(){e.visible=!0,e.loading=!0,B["c"].get("".concat(B["a"].SECTION_PARTITION,"/section-to-activity")).then(function(t){e.loading=!1;for(var i=t.list,n=0,a=0,o=0,r=0;r<i.length;r++)if(i[r].rowspan5=1,0!==r){if(i[r].sectionID1&&i[r].sectionID1===i[r-1].sectionID1)i[r].rowspan1=0;else{n=r;var s=void 0;for(s=r-1;s>0&&i[s].sectionID1&&i[s].sectionID1===i[s-1].sectionID1;s--);i[s].rowspan1=r-s}if(i[r].sectionID2&&i[r].sectionID2===i[r-1].sectionID2)i[r].rowspan2=0;else{a=r;var l=void 0;for(l=r-1;l>0&&i[l].sectionID2&&i[l].sectionID2===i[l-1].sectionID2;l--);i[l].rowspan2=r-l}if(i[r].sectionID3&&i[r].sectionID3===i[r-1].sectionID3)i[r].rowspan3=0;else{o=r;var c=void 0;for(c=r-1;c>0&&i[c].sectionID3&&i[c].sectionID3===i[c-1].sectionID3;c--);i[c].rowspan3=r-c}}i[n].rowspan1=i.length-n,i[a].rowspan2=i.length-a,i[o].rowspan3=i.length-o,e.list=i})})},created:function(){}},W=U,X=(i("2f6b"),Object(h["a"])(W,z,K,!1,null,"30dff615",null)),G=X.exports,Q=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"dialog-detail-section"},[i("el-dialog",{attrs:{title:"查看单元信息",visible:e.visible,modal:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",attrs:{model:e.record,rules:e.rules}},[e._l(e.parentSections,function(t,n){return i("el-form-item",{key:n,attrs:{label:["分公司","班组","岗位"][n]+"单元名称："}},[i("el-input",{attrs:{value:e.parentSection[t],readonly:""}})],1)}),e.$parent.clickedNode&&e.$parent.clickedNode.level<e.postLevel?i("el-form-item",{attrs:{label:"对应机构：",prop:"sectionNum"}},[i("el-select",{attrs:{value:e.record.sectionNum,filterable:"",disabled:""}},e._l(e.institutions,function(e,t){return i("el-option",{key:t,attrs:{value:e.InstitutionNum,label:e.InstitutionName}})}),1)],1):e._e(),i("el-form-item",{attrs:{label:e.getSectionLabel()+"单元名称",prop:"sectionName"}},[i("el-input",{attrs:{value:e.record.sectionName,clearable:"",readonly:""}})],1),e.$parent.clickedNode&&e.parentNode.level===e.postLevel-1?i("el-form-item",{attrs:{label:"单元编号：",prop:"sectionNum"}},[i("el-input",{attrs:{value:e.record.sectionNum,clearable:"",readonly:""}})],1):e._e(),i("el-form-item",{attrs:{label:"创建日期：",prop:"createdTime"}},[i("el-date-picker",{attrs:{value:e.record.createdTime,clearable:"",readonly:""}})],1)],2),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("关 闭")])],1)],1)],1)},V=[],Z={name:"SectionEdit",data:function(){return{record:{sectionName:null,sectionNum:null,createdTime:null}}},mixins:[k],created:function(){var e=this;s["a"].$on("show-detail-section",function(){e.parentSection=e.getParentSection(e.$parent.clickedNode.parent),e.record.sectionID=Number(e.$parent.clickedNode.data.id),e.hasChanges=!1,e.visible=!0,e.loading=!0,r["c"].get(r["a"].SECTION_PARTITION+"/section/".concat(e.record.sectionID),function(t){e.loading=!1,e.record=t.record||{}})})}},ee=Z,te=Object(h["a"])(ee,Q,V,!1,null,"05d5d60b",null),ie=te.exports,ne=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"dialog-detail-activity"},[i("el-dialog",{attrs:{title:"查看作业活动信息",visible:e.visible,modal:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",attrs:{model:e.record,rules:e.rules}},[e._l(e.parentSections,function(t,n){return i("el-form-item",{key:n,attrs:{label:["分公司","班组","岗位"][n]+"单元名称："}},[i("el-input",{attrs:{value:e.parentSection[t],readonly:""}})],1)}),i("el-form-item",{attrs:{label:"作业活动名称：",prop:"aename"}},[i("el-input",{attrs:{value:e.record.aename,clearable:"",readonly:""}})],1),i("el-form-item",{attrs:{label:"作业地点：",prop:"location"}},[i("el-input",{attrs:{clearable:"",readonly:""},model:{value:e.record.location,callback:function(t){e.$set(e.record,"location",t)},expression:"record.location"}})],1),i("el-form-item",{attrs:{label:"备注：",prop:"aememo"}},[i("el-input",{attrs:{value:e.record.aememo,clearable:"",readonly:""}})],1)],2),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("关 闭")])],1)],1)],1)},ae=[],oe={name:"ActivityDetail",data:function(){return{record:{aename:null,aememo:null,location:null}}},mixins:[k],created:function(){var e=this;s["a"].$on("show-detail-activity",function(){e.hasChanges=!1;var t=e.$parent.clickedNode.data.id;e.record.aeinfoID=Number(t.substring(t.indexOf("-")+1)),e.visible=!0,e.parentSection=e.getParentSection(e.$parent.clickedNode.parent),e.loading=!0,r["c"].get(r["a"].SECTION_PARTITION+"/activity/".concat(e.record.aeinfoID)).then(function(t){e.loading=!1,e.record=t.record||{}})})}},re=oe,se=Object(h["a"])(re,ne,ae,!1,null,"7291ed02",null),le=se.exports,ce=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"copy-dialog"},[i("el-dialog",{attrs:{title:"分公司单元复制",visible:e.visible,modal:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dialog-wrapper"},[i("div",{staticClass:"section"},[i("el-form",[i("el-form-item",{attrs:{label:"分公司单元归档年份："}},[i("el-select",{on:{change:function(t){return e.getSections(e.establishYear)}},model:{value:e.establishYear,callback:function(t){e.establishYear=t},expression:"establishYear"}},e._l(e.list_establishYear,function(e,t){return i("el-option",{key:t,attrs:{label:e.EstablishYear,value:e.EstablishYear}})}),1)],1)],1)],1),i("div",{staticClass:"section"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.idList_section=e.list_section.map(function(e){return e.sectionID})}}},[e._v("全 选")]),i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.idList_section=[]}}},[e._v("全不选")])],1),i("div",{staticClass:"section"},[i("div",{staticClass:"list-table"},[i("table",[i("tbody",[i("tr",[i("th",{attrs:{width:"15%"}},[i("div",[i("span",[e._v("#")])])]),i("th",{attrs:{width:"35%"}},[i("div",[i("span",[e._v("单元名称")])])]),i("th",{attrs:{width:"35%"}},[i("div",[i("span",[e._v("对应机构")])])]),i("th",{attrs:{width:"35%"}},[i("div",[i("span",[e._v("归档日期")])])])]),e._l(e.list_section,function(t,n){return i("tr",{key:n},[i("td",[i("el-checkbox",{attrs:{size:"medium","true-label":t.sectionID},model:{value:e.idList_section[n],callback:function(t){e.$set(e.idList_section,n,t)},expression:"idList_section[index]"}})],1),i("td",{attrs:{title:t.sectionName}},[e._v(e._s(t.sectionName))]),i("td",{attrs:{title:t.relatedInstitution}},[e._v(e._s(t.relatedInstitution))]),i("td",{attrs:{title:e.$moment(t.archivedTime).format("YYYY-MM-DD HH:mm:ss")}},[e._v("\n              "+e._s(e.$moment(t.archivedTime).format("YYYY-MM-DD HH:mm:ss"))+"\n            ")])])})],2)])])])]),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("关 闭")]),i("el-button",{attrs:{type:"primary"},on:{click:e.copy}},[e._v("复 制")])],1)])],1)},de=[],ue={name:"SectionCopy",data:function(){return{list_section:[],list_establishYear:[],idList_section:[],loading:!1,visible:!1,establishYear:null,hasChanges:!1,existingInstitutions:[]}},watch:{visible:function(e){e||this.hasChanges&&s["a"].$emit("update-tree")}},created:function(){var e=this;s["a"].$on("show-copy",function(){console.log(e.$parent),e.existingInstitutions=e.$parent.$refs.tree.root.childNodes.map(function(e){return e.data.sectionNum}),e.visible=!0,e.loading=!0,e.hasChanges=!1,e.establishYear=null,e.list_section=[],r["c"].get(r["a"].SECTION_PARTITION+"/archived-year").then(function(t){e.loading=!1,e.list_establishYear=t.list.filter(function(e){return e.EstablishYear})})})},methods:{copy:function(){var e=this;if(this.idList_section.map(function(e,t){return e?t:-1}).filter(function(e){return-1!==e}).map(function(t){return e.list_section[t].sectionNum}).filter(function(t){return e.existingInstitutions.indexOf(t)>-1}).length>0)this.$message.warning("所选记录中含有现有单元划分中已存在的机构对应单元");else{var t=this.idList_section.filter(function(e){return e});t.length>0?(this.loading=!0,r["c"].post(r["a"].SECTION_PARTITION+"/section-copy",{idList:t.join(",")}).then(function(t){e.loading=!1,"ok"===t.status?(e.$message.success("复制成功！"),e.hasChanges=!0):e.$message.error("数据传输错误！")})):this.$message.warning("请先选择几条记录！")}},getSections:function(e){var t=this;this.loading=!0,r["c"].get(r["a"].SECTION_PARTITION+"/section-by-year/"+e).then(function(e){t.loading=!1,t.list_section=e.list,t.idList_section=t.list_section.map(function(e){return""})})}}},me=ue,fe=Object(h["a"])(me,ce,de,!1,null,"198295f4",null),pe=fe.exports,ve={name:"App",store:l["a"],components:{SectionAdd:w,RightClickMenu:g,ActivityAdd:D,SectionEdit:q,ActivityEdit:F,AllDetail:G,SectionDetail:ie,ActivityDetail:le,SectionCopy:pe},provide:function(){var e=this,t=function(t){if(!t)return{};for(var i={};t&&t.parent&&t.level>=1;t=t.parent)i["name"+t.level]=t.data.label,i["id"+t.level]=Number(t.data.id),t.level===e.postLevel-1&&(i["sectionNum"]=t.data.sectionNum);return i},i={sectionName:[{required:!0,message:"不能为空",trigger:"blur"}],createdTime:[{required:!0,message:"不能为空",trigger:"blur"}],sectionNum:[{required:!0,message:"不能为空",trigger:"blur"}],aename:[{required:!0,message:"不能为空",trigger:"blur"}]};return{postLevel:this.postLevel,getParentSection:t,rules:i}},data:function(){return{list:[],instList:[],loading:!1,clickedNode:null,postLevel:3,userRole:null,filterTreeText:null,userRightEditable:!1}},watch:{filterTreeText:function(e){this.$refs.tree.filter(e)}},computed:Object(o["a"])({},Object(f["b"])(["user"]),{copyRight:function(){return r["g"].indexOf(this.user.inst1)>-1}}),methods:{addInitNode:function(){0===this.$refs.tree.root.childNodes.length&&this.$refs.tree.append({id:"0",label:"无单元数据，可在此点击右键添加同级以添加主单元"})},archiveAll:function(){var e=this,t=this.$refs.tree.root;"0"===t.childNodes[0].data.id?this.$message.warning("请先添加几个单元！"):this.$confirm("确定将全部单元归档吗？").then(function(){e.loading=!0,Promise.all(t.childNodes.map(function(e){return r["c"].put(r["a"].SECTION_PARTITION+"/section-archive",{id:e.data.id,level:1})})).then(function(t){e.$message.success("归档成功！"),e.loading=!1,e.clearTree(),e.addInitNode()})})},showCopy:function(){s["a"].$emit("show-copy")},showDetailAll:function(){s["a"].$emit("show-detail-all")},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},nodeRightClick:function(e,t,i){this.clickedNode=i,s["a"].$emit("show-menu",{type:this.clickedNode.level<=this.postLevel?"section":"activity",x:e.pageX,y:e.pageY,level:this.clickedNode.level})},nodeLeftClickToHide:function(){s["a"].$emit("hide-menu")},clearTree:function(){var e=this.$refs.tree.root;if(e)while(e.childNodes.length>0)this.$refs.tree.remove(e.childNodes[0].data.id)},addAllFromInstitutions:function(){var e=this;"0"===this.$refs.tree.root.childNodes[0].data.id?(this.loading=!0,r["c"].post(r["a"].SECTION_PARTITION+"/add-all-from-institution").then(function(t){e.$message.success("添加成功！"),e.updateTree()})):this.$message.warning("请首先归档或删除所有单元！")},exportAll:function(){r["c"].formSubmit(r["a"].SECTION_PARTITION+"/export",{})},updateTree:function(){var e=this;this.loading=!0,r["c"].get(r["a"].SECTION_PARTITION+"/section-tree",function(t){t.list&&t.list.filter(function(e){return!e.archivedTime&&5!==e.level}).length>0?([1,2,3,5].map(function(e){return t.list.filter(function(t){return t.level===e})}).forEach(function(t){t.forEach(function(t){t.archivedTime||e.$refs.tree.append({id:t.level<=e.postLevel?t.sectionID+"":t.level+"-"+t.sectionID,label:t.sectionName,sectionNum:t.sectionNum},t.parentSection?t.parentSection+"":null)})}),e.$refs.tree.remove("0"),e.loading=!1):(e.$refs.tree.append({id:"0",label:"无单元数据，可在此点击右键添加同级以添加主单元"}),e.loading=!1)})},beforeRouteLeave:function(e,t,i){this.$destroy(),i()}},mounted:function(){this.updateTree()},created:function(){var e=this;this.userRightEditable=Object(r["d"])("030100"),this.$store.dispatch("updateUser"),this.$store.dispatch("updateInstitutions"),m()(document).on("click",function(){s["a"].$emit("hide-menu")}),s["a"].$on("add-node",function(t){var i=t.data,n=t.parentKey;e.$refs.tree.append(i,n),"0"===e.clickedNode.data.id&&e.$refs.tree.remove("0")}),s["a"].$on("delete-node",function(){var t=e.clickedNode.data.id,i=e.clickedNode.level<=e.postLevel?t:t.substring(t.indexOf("-")+1);e.$confirm("确认删除".concat(e.clickedNode.data.label,"吗？")).then(function(){e.loading=!0,r["c"].delete("".concat(r["a"].SECTION_PARTITION,"/section-delete"),{id:i,level:e.clickedNode.level}).then(function(i){e.loading=!1,e.$message.success("删除成功"),e.$refs.tree.remove(t),e.addInitNode()})})}),s["a"].$on("archive-node",function(){var t=e.clickedNode.data.id;e.$confirm("确认归档".concat(e.clickedNode.data.label,"吗？")).then(function(){e.loading=!0,r["c"].put("".concat(r["a"].SECTION_PARTITION,"/section-archive"),{id:t,level:e.clickedNode.level}).then(function(i){e.loading=!1,e.$message.success("归档成功"),e.$refs.tree.remove(t),e.addInitNode()})})}),s["a"].$on("edit-node",function(t){var i=t.key,n=t.label;e.$refs.tree.getNode(i).data.label=n}),s["a"].$on("update-tree",function(){e.clearTree(),e.updateTree()})}},he=ve,be=(i("b7b5"),i("dec7"),Object(h["a"])(he,n,a,!1,null,"092cc07c",null));t["default"]=be.exports},a4bb:function(e,t,i){e.exports=i("8aae")},a594:function(e,t,i){"use strict";var n=i("671f"),a=i.n(n);a.a},b7b5:function(e,t,i){"use strict";var n=i("83f0"),a=i.n(n);a.a},bf90:function(e,t,i){var n=i("36c3"),a=i("bf0b").f;i("ce7e")("getOwnPropertyDescriptor",function(){return function(e,t){return a(n(e),t)}})},c67c:function(e,t,i){},ce7e:function(e,t,i){var n=i("63b6"),a=i("584a"),o=i("294c");e.exports=function(e,t){var i=(a.Object||{})[e]||Object[e],r={};r[e]=t(i),n(n.S+n.F*o(function(){i(1)}),"Object",r)}},cebc:function(e,t,i){"use strict";var n=i("268f"),a=i.n(n),o=i("e265"),r=i.n(o),s=i("a4bb"),l=i.n(s),c=i("85f2"),d=i.n(c);function u(e,t,i){return t in e?d()(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function m(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},n=l()(i);"function"===typeof r.a&&(n=n.concat(r()(i).filter(function(e){return a()(i,e).enumerable}))),n.forEach(function(t){u(e,t,i[t])})}return e}i.d(t,"a",function(){return m})},dec7:function(e,t,i){"use strict";var n=i("8406"),a=i.n(n);a.a},e265:function(e,t,i){e.exports=i("ed33")},ed33:function(e,t,i){i("014b"),e.exports=i("584a").Object.getOwnPropertySymbols},fde4:function(e,t,i){i("bf90");var n=i("584a").Object;e.exports=function(e,t){return n.getOwnPropertyDescriptor(e,t)}}}]);
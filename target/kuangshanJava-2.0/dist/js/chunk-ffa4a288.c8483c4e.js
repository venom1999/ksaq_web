(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ffa4a288"],{"0a49":function(e,t,a){var i=a("9b43"),n=a("626a"),s=a("4bf8"),l=a("9def"),o=a("cd1c");e.exports=function(e,t){var a=1==e,r=2==e,c=3==e,d=4==e,u=6==e,f=5==e||u,p=t||o;return function(t,o,m){for(var h,v,g=s(t),b=n(g),y=i(o,m,3),x=l(b.length),D=0,C=a?p(t,x):r?p(t,0):void 0;x>D;D++)if((f||D in b)&&(h=b[D],v=y(h,D,g),e))if(a)C[D]=v;else if(v)switch(e){case 3:return!0;case 5:return h;case 6:return D;case 2:C.push(h)}else if(d)return!1;return u?-1:c||d?d:C}}},"268f":function(e,t,a){e.exports=a("fde4")},"2cdc":function(e,t,a){"use strict";var i=a("2b0e");t["a"]=new i["default"]},"32a6":function(e,t,a){var i=a("241e"),n=a("c3a1");a("ce7e")("keys",function(){return function(e){return n(i(e))}})},4418:function(e,t,a){"use strict";var i=a("6891"),n=a.n(i);n.a},"454f":function(e,t,a){a("46a7");var i=a("584a").Object;e.exports=function(e,t,a){return i.defineProperty(e,t,a)}},"46a7":function(e,t,a){var i=a("63b6");i(i.S+i.F*!a("8e60"),"Object",{defineProperty:a("d9f6").f})},"5df3":function(e,t,a){"use strict";var i=a("02f4")(!0);a("01f9")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,a=this._i;return a>=t.length?{value:void 0,done:!0}:(e=i(t,a),this._i+=e.length,{value:e,done:!1})})},6891:function(e,t,a){},7514:function(e,t,a){"use strict";var i=a("5ca1"),n=a("0a49")(5),s="find",l=!0;s in[]&&Array(1)[s](function(){l=!1}),i(i.P+i.F*l,"Array",{find:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")(s)},"7f7f":function(e,t,a){var i=a("86cc").f,n=Function.prototype,s=/^\s*function ([^ (]*)/,l="name";l in n||a("9e1e")&&i(n,l,{configurable:!0,get:function(){try{return(""+this).match(s)[1]}catch(e){return""}}})},"85f2":function(e,t,a){e.exports=a("454f")},"8aae":function(e,t,a){a("32a6"),e.exports=a("584a").Object.keys},a4bb:function(e,t,a){e.exports=a("8aae")},a51b:function(e,t,a){"use strict";var i=a("ff3d"),n=a.n(i);n.a},b6ca:function(e,t,a){},bf90:function(e,t,a){var i=a("36c3"),n=a("bf0b").f;a("ce7e")("getOwnPropertyDescriptor",function(){return function(e,t){return n(i(e),t)}})},c91d:function(e,t,a){"use strict";var i=a("b6ca"),n=a.n(i);n.a},cd1c:function(e,t,a){var i=a("e853");e.exports=function(e,t){return new(i(e))(t)}},ce7e:function(e,t,a){var i=a("63b6"),n=a("584a"),s=a("294c");e.exports=function(e,t){var a=(n.Object||{})[e]||Object[e],l={};l[e]=t(a),i(i.S+i.F*s(function(){a(1)}),"Object",l)}},cebc:function(e,t,a){"use strict";var i=a("268f"),n=a.n(i),s=a("e265"),l=a.n(s),o=a("a4bb"),r=a.n(o),c=a("85f2"),d=a.n(c);function u(e,t,a){return t in e?d()(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function f(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},i=r()(a);"function"===typeof l.a&&(i=i.concat(l()(a).filter(function(e){return n()(a,e).enumerable}))),i.forEach(function(t){u(e,t,a[t])})}return e}a.d(t,"a",function(){return f})},e265:function(e,t,a){e.exports=a("ed33")},e852:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("el-header",{attrs:{height:"48px"}},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("a",{attrs:{href:"../riskcontrol/riskmanagement/section_description.jsp"}},[e._v("岗位风险描述")])]),a("el-breadcrumb-item",[e._v("危险有害因素辨识")])],1)],1),a("div",{staticClass:"wrapper"},[a("div",{staticClass:"content"},[a("div",{staticClass:"section"},[a("div",{staticClass:"list-filter"},[a("el-row",{staticStyle:{"margin-bottom":"15px"}},[a("el-col",{attrs:{span:7}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                  "+e._s(e.params[0].label)+"\n                ")]),a("el-col",{attrs:{span:16}},[a("el-select",{attrs:{filterable:"",clearable:""},model:{value:e.params[0].value,callback:function(t){e.$set(e.params[0],"value",t)},expression:"params[0].value"}},e._l(e.sectionList.filter(function(e){return 1===e.level&&!e.archivedTime}),function(e,t){return a("el-option",{key:t,attrs:{value:e.sectionID,label:e.sectionName}})}),1)],1)],1),a("el-col",{attrs:{span:7}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                  "+e._s(e.params[1].label)+"\n                ")]),a("el-col",{attrs:{span:16}},[a("el-select",{attrs:{filterable:"",clearable:""},model:{value:e.params[1].value,callback:function(t){e.$set(e.params[1],"value",t)},expression:"params[1].value"}},e._l(e.sectionList.filter(function(e){return 3===e.level&&!e.archivedTime}),function(e,t){return a("el-option",{key:t,attrs:{value:e.sectionID,label:e.sectionName}})}),1)],1)],1),a("el-col",{attrs:{span:7}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                  "+e._s(e.params[2].label)+"\n                ")]),a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{clearable:""},model:{value:e.params[2].value,callback:function(t){e.$set(e.params[2],"value",t)},expression:"params[2].value"}})],1)],1),a("el-col",{attrs:{span:2}},[a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:e.filter}},[e._v("查 询")])],1)],1),a("el-row",[a("el-col",{attrs:{span:7}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                  "+e._s(e.params[3].label)+"\n                ")]),a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{clearable:""},model:{value:e.params[3].value,callback:function(t){e.$set(e.params[3],"value",t)},expression:"params[3].value"}})],1)],1),a("el-col",{attrs:{span:7}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                  "+e._s(e.params[4].label)+"\n                ")]),a("el-col",{attrs:{span:16}},[a("el-date-picker",{attrs:{type:"daterange",clearable:""},model:{value:e.params[4].value,callback:function(t){e.$set(e.params[4],"value",t)},expression:"params[4].value"}})],1)],1),a("el-col",{attrs:{span:7}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                  "+e._s(e.params[5].label)+"\n                ")]),a("el-col",{attrs:{span:16}},[a("el-select",{attrs:{filterable:"",clearable:""},model:{value:e.params[5].value,callback:function(t){e.$set(e.params[5],"value",t)},expression:"params[5].value"}},[a("el-option",{attrs:{value:"0",label:"未归档"}}),a("el-option",{attrs:{value:"1",label:"已归档"}})],1)],1)],1)],1)],1)]),a("div",{staticClass:"section"},[a("div",{staticClass:"list-operation"},[e.userRightEditable?a("el-button",{staticClass:"operation-editable",attrs:{type:"primary"},on:{click:e.showAddDialog}},[e._v("添 加")]):e._e(),e.userRightEditable&&!e.showArchivedRecords?a("el-button",{staticClass:"operation-editable",attrs:{type:"primary"},on:{click:e.deleteRecord}},[e._v("删 除")]):e._e()],1)]),a("div",{staticClass:"section"},[a("div",{staticClass:"list-table"},[a("table",[a("tbody",[a("tr",[a("th",{attrs:{width:"4%"}},[a("div",[e._v("#\n")])]),a("th",{attrs:{width:"6%"}},[a("div",[a("span",[e._v("分公司")])])]),a("th",{attrs:{width:"6%"}},[a("div",[a("span",[e._v("班组")])])]),a("th",{attrs:{width:"10%"}},[a("div",[a("span",[e._v("岗位单元（编号）")])])]),a("th",{attrs:{width:"8%"}},[a("div",[a("span",[e._v("填写人")])])]),a("th",{attrs:{width:"8%"}},[a("div",[a("span",[e._v("审核人")])])]),a("th",{attrs:{width:"10%"}},[a("div",[a("span",[e._v("辨识时间")])])]),a("th",{attrs:{width:"10%"}},[a("div",[a("span",[e._v("操作")])])])]),e._l(e.list,function(t,i){return a("tr",{key:i},[a("td",[a("el-checkbox",{attrs:{size:"medium","true-label":t.DangerFactorMainID},model:{value:e.idList[i],callback:function(t){e.$set(e.idList,i,t)},expression:"idList[index]"}})],1),a("td",{attrs:{title:t.sectionName1}},[e._v(e._s(t.sectionName1))]),a("td",{attrs:{title:t.sectionName2}},[e._v(e._s(t.sectionName2))]),a("td",{attrs:{title:t.sectionName3+"("+t.sectionNum+")"}},[e._v(e._s(t.sectionName3+"("+t.sectionNum+")"))]),a("td",{attrs:{title:t.fillFormPersonName}},[e._v(e._s(t.fillFormPersonName))]),a("td",{attrs:{title:t.checkPersonName}},[e._v(e._s(t.checkPersonName))]),a("td",{attrs:{title:e.$moment(t.createTime).format("YYYY-MM-DD HH:mm:ss")}},[e._v(e._s(e.$moment(t.createTime).format("YYYY-MM-DD HH:mm:ss")))]),a("td",[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.showDetailDialog(t.DangerFactorMainID)}}},[e._v("详细")]),e.userRightEditable&&e.checkAuth(t.sectionInst1,t.sectionInst2)&&!e.showArchivedRecords?a("el-button",{staticClass:"operation-editable",attrs:{type:"text"},on:{click:function(a){return e.showEditDialog(t.DangerFactorMainID)}}},[e._v("修改")]):e._e()],1)])})],2)])])]),a("div",{staticClass:"section"},[a("div",{staticClass:"list-pagination"},[e.pageNum>0?a("el-pagination",{attrs:{background:"","page-size":"10",layout:"prev, pager, next","current-page":e.pageIndex,total:10*e.pageNum},on:{"current-change":e.updateListTable}}):a("div",{staticClass:"list-hint"},[e._v("提示：列表中无数据")])],1)])])]),a("div",{staticClass:"pop-dialog"},[a("add-dialog"),a("edit-dialog"),a("detail-dialog"),a("add-act-dialog"),a("edit-act-dialog"),a("danger-detail"),a("level1-danger-dialog"),a("danger-right-click-menu",{attrs:{"user-right-editable":e.userRightEditable}})],1)],1)},n=[],s=(a("c5f6"),a("ac6a"),a("5df3"),a("7514"),a("cebc")),l=a("d257"),o=a("2f62"),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-dialog fullscreen-dialog"},[a("el-dialog",{attrs:{title:"添加危险有害因素辨识",visible:e.visible,modal:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,fullscreen:!0},on:{"update:visible":function(t){e.visible=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dialog-wrapper"},[a("div",{staticClass:"section"},[a("div",{staticClass:"list-filter",staticStyle:{"margin-top":"1em"}},[a("el-row",{staticStyle:{"margin-top":"1em"}},[a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                分公司：\n              ")]),a("el-col",{attrs:{span:15}},[a("el-select",{attrs:{disabled:e.addClicked},on:{change:function(t){return e.getSectionList(2,e.context.sectionID1)}},model:{value:e.context.sectionID1,callback:function(t){e.$set(e.context,"sectionID1",t)},expression:"context.sectionID1"}},e._l(e.sectionList1_,function(e,t){return a("el-option",{key:t,attrs:{value:e.sectionID,label:e.sectionName}})}),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                班组：\n              ")]),a("el-col",{attrs:{span:15}},[a("el-select",{attrs:{disabled:e.addClicked},on:{change:function(t){return e.getSectionList(3,e.context.sectionID2)}},model:{value:e.context.sectionID2,callback:function(t){e.$set(e.context,"sectionID2",t)},expression:"context.sectionID2"}},e._l(e.sectionList2_,function(e,t){return a("el-option",{key:t,attrs:{value:e.sectionID,label:e.sectionName}})}),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                岗位单元：\n              ")]),a("el-col",{attrs:{span:15}},[a("el-select",{attrs:{disabled:e.addClicked},on:{change:e.setSectionNum},model:{value:e.context.sectionID3,callback:function(t){e.$set(e.context,"sectionID3",t)},expression:"context.sectionID3"}},e._l(e.sectionList3,function(e,t){return a("el-option",{key:t,attrs:{value:e.sectionID,label:e.sectionName}})}),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                唯一性编号：\n              ")]),a("el-col",{attrs:{span:15}},[a("el-input",{attrs:{value:e.context.sectionNum,readonly:""}})],1)],1)],1),a("el-row",{staticStyle:{"margin-top":"1em"}},[a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                填写人：\n              ")]),a("el-col",{attrs:{span:15}},[a("el-input",{attrs:{value:e.user.userName,readonly:""}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                审核人：\n              ")]),a("el-col",{attrs:{span:15}},[a("el-select",{attrs:{disabled:e.addClicked,filterable:""},model:{value:e.context.checkPerson,callback:function(t){e.$set(e.context,"checkPerson",t)},expression:"context.checkPerson"}},e._l(e.employees,function(e,t){return a("el-option",{key:t,attrs:{value:e.EmployeeNum,label:e.EmployeeAlias}})}),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                辨识时间：\n              ")]),a("el-col",{attrs:{span:15}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss",disabled:e.addClicked,clearable:""},model:{value:e.context.createTime,callback:function(t){e.$set(e.context,"createTime",t)},expression:"context.createTime"}})],1)],1)],1),a("el-row",{staticStyle:{"text-align":"right","margin-top":"1.5em"}},[a("el-button",{attrs:{disabled:e.addClicked||!e.contextCompleted,type:"primary"},on:{click:e.addIdent}},[e._v("添 加")]),a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("关 闭")])],1)],1)]),a("div",{staticClass:"section"},[a("el-tree",{directives:[{name:"show",rawName:"v-show",value:e.addClicked,expression:"addClicked"}],ref:"tree",attrs:{"node-key":"id",indent:"0","default-expand-all":!0,"expand-on-click-node":!0,"highlight-current":""},on:{"node-click":e.nodeLeftClickToHide,"node-contextmenu":e.nodeRightClick},scopedSlots:e._u([{key:"default",fn:function(t){t.node;var i=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[e._v(e._s(i.label))])])}}])})],1)])])],1)},c=[],d=a("2cdc"),u=(a("456d"),a("ae03")),f=a("1157"),p=a.n(f),m={data:function(){return{editType:null,visible:!1,hasChanges:!1,sectionList1:[],sectionList2:[],sectionList3:[],activityList:[],idList:[],loading:!1,id:"",node:null,dangerList:[],idListAct:[],context:{sectionID1:null,sectionID2:null,sectionID3:null,sectionNum:null,checkPerson:null,createTime:null,fillFormPerson:null,dangerFactorMainID:null}}},watch:{visible:function(e){var t=this;e&&(p()(document).on("click",function(){d["a"].$emit("hide-danger-menu")}),d["a"].$on("delete-danger-node",function(){t.$refs.tree.remove(t.node.data.id)}),d["a"].$on("edit-danger-node",function(e){var a=e.id,i=e.label;a&&(t.node.data.id=a),t.node.data.label=i}),d["a"].$on("add-danger-node",function(e){console.log(e),console.log(t.node),t.$refs.tree.append(e,t.node.data.id)})),e||(d["a"].$emit("hide-danger-menu"),["add-danger-node","edit-danger-node","delete-danger-node"].forEach(function(e){d["a"].$off(e)}),p()(document).off("click"),this.hasChanges&&(Object.keys(this.context).forEach(function(e){t.context[e]=null}),d["a"].$emit("ident-list-changed")))}},computed:Object(s["a"])({idsAct:function(){return this.idListAct.filter(function(e){return e})},contextCompleted:function(){var e=this.context;return e.sectionID1&&e.sectionID2&&e.sectionID3}},Object(o["b"])(["user","employees","accidents"])),methods:{getID:function(e){return e.substring(e.lastIndexOf("-")+1)},handleMenuItemClicked:function(e){var t=this;switch(e){case"add-second":d["a"].$emit("show-add-act",{activityList:this.activityList,firstLevelDanger:this.node.data.label,aeinfoID:Number(this.getID(this.node.parent.data.id)),dangerFactorMainID:this.context.dangerFactorMainID});break;case"edit-second":d["a"].$emit("show-edit-act",{id:Number(this.getID(this.node.data.id)),activityList:this.activityList});break;case"detail-second":d["a"].$emit("show-detail-act",{id:Number(this.getID(this.node.data.id)),activityList:this.activityList});break;case"add-first":d["a"].$emit("show-level1-danger",{type:"add",node:this.node});break;case"edit-first":d["a"].$emit("show-level1-danger",{type:"edit",node:this.node});break;case"delete-second":this.$confirm("确认删除第二类危险源吗？").then(function(){t.loading=!0,u["c"].delete(u["a"].SECTION_PARTITION+"/section-delete",{level:6,id:Number(t.getID(t.node.data.id))}).then(function(e){t.loading=!1,t.$message.success("删除成功！"),d["a"].$emit("delete-danger-node",t.node.data.id)})});break;case"delete-first":this.$confirm("确认删除第一类危险源吗，这将删除其下的第二类危险源？").then(function(){t.node.childNodes&&t.node.childNodes.length>0?(t.loading=!0,Promise.all(t.node.childNodes.map(function(e){return u["c"].delete(u["a"].SECTION_PARTITION+"/section-delete",{level:6,id:Number(t.getID(e.data.id))})})).then(function(e){t.loading=!1,t.$message.success("删除成功！"),d["a"].$emit("delete-danger-node",t.node.data.id)})):d["a"].$emit("delete-danger-node",t.node.data.id)});break}},nodeRightClick:function(e,t,a){this.node=a,d["a"].$emit("show-danger-menu",{node:a,x:e.pageX,y:e.pageY,type:this.editType,handleClick:this.handleMenuItemClicked})},nodeLeftClickToHide:function(){d["a"].$emit("hide-danger-menu")},updateDialog:function(e){var t=this;this.id=e,this.loading=!0,Promise.all([u["c"].get("".concat(u["a"].SECTION_IDENT,"/ident/").concat(e)),u["c"].get("".concat(u["a"].SECTION_IDENT,"/danger-list/").concat(e))]).then(function(e){t.context=e[0].record,t.context.dangerFactorFatherID=t.context.sectionID3,t.context.dangerFactorMainID=t.context.DangerFactorMainID,t.activityList=e[0].activityList,t.clearTree(),t.initTree(e[1].list),t.loading=!1})},initTree:function(e){var t=this.$refs.tree;this.activityList.forEach(function(e){t.append({id:"activity-".concat(e.AEInfoID),label:e.AEName})}),e&&(e.forEach(function(e){var a="first-".concat(e.AEInfoID,"-").concat(e.FirstLevelDanger);t.getNode(a)||t.append({id:a,label:e.FirstLevelDanger},"activity-".concat(e.AEInfoID))}),e.forEach(function(e){t.append({id:"second-".concat(e.ActDangerFactorID),label:e.DangerFactorName},"first-".concat(e.AEInfoID,"-").concat(e.FirstLevelDanger))}))},getSectionList:function(e,t){var a=this;this.loading=!0,u["c"].get("".concat(u["a"].SECTION_IDENT,"/section-list/").concat(t||0),function(t){switch(a.loading=!1,a["sectionList"+e]=t.list,e){case 1:a.context.sectionID1=null,a.sectionList2=[],a.context.sectionID2=null,a.sectionList3=[],a.context.sectionID3=null,a.context.sectionNum=null,a.context.CheckPerson=null;break;case 2:a.context.sectionID2=null,a.sectionList3=[],a.context.sectionID3=null,a.context.sectionNum=null;break;case 3:a.context.sectionID3=null,a.context.sectionNum=null;break}})},clearTree:function(){var e=this.$refs.tree;e.root.childNodes&&e.root.childNodes.map(function(e){return e.data.id}).forEach(function(t){e.remove(t)})}}},h={name:"AddDialog",mixins:[m],data:function(){return{addClicked:!1,editType:"add"}},computed:{sectionList1_:function(){var e=this;return this.user&&-1===l["g"].indexOf(this.user.inst1)?this.sectionList1.filter(function(t){return[e.user.inst1,e.user.inst2].indexOf(t.sectionNum)>-1}):this.sectionList1},sectionList2_:function(){var e=this;return this.user&&-1===l["g"].indexOf(this.user.inst1)&&this.user.inst2?this.sectionList2.filter(function(t){return t.sectionNum===e.user.inst1}):this.sectionList2}},methods:{setSectionNum:function(){var e=this,t=this.sectionList3.filter(function(t){return t.sectionID===e.context.sectionID3});t.length>0&&(this.context.sectionNum=t[0].sectionNum),this.context.dangerFactorFatherID=this.context.sectionID3},addIdent:function(){var e=this;this.loading=!0,l["c"].postJson(l["a"].SECTION_IDENT+"/ident",this.context,function(t){e.loading=!1,t.activityList?(e.activityList=t.activityList,e.$message.success("提交成功！"),e.addClicked=!0,e.context.dangerFactorMainID=t.dangerFactorMainID,e.hasChanges=!0,e.clearTree(),e.initTree()):e.$message.error("岗位单元下没有添加作业活动！")})}},created:function(){var e=this;d["a"].$on("show-add-ident",function(t){e.addClicked=!1,e.visible=!0,e.loading=!0,e.context.checkPerson=e.user.userId,e.context.fillFormPerson=e.user.userId,e.context.createTime=new Date,e.dangerList=[],e.getSectionList(1)})}},v=h,g=a("2877"),b=Object(g["a"])(v,r,c,!1,null,null,null),y=b.exports,x=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"add-dialog fullscreen-dialog"},[a("el-dialog",{attrs:{title:"修改危险有害因素辨识",visible:e.visible,modal:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,fullscreen:!0},on:{"update:visible":function(t){e.visible=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dialog-wrapper"},[a("div",{staticClass:"section"},[a("div",{staticClass:"list-filter",staticStyle:{"margin-top":"1em"}},[a("el-row",{staticStyle:{"margin-bottom":"1em"}},[a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                  分公司：\n                ")]),a("el-col",{attrs:{span:15}},[a("el-input",{attrs:{value:e.context.sectionName1,readonly:""}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                  班组：\n                ")]),a("el-col",{attrs:{span:15}},[a("el-input",{attrs:{value:e.context.sectionName2,readonly:""}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                  岗位单元：\n                ")]),a("el-col",{attrs:{span:15}},[a("el-input",{attrs:{value:e.context.sectionName3,readonly:""}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                  唯一性编号：\n                ")]),a("el-col",{attrs:{span:15}},[a("el-input",{attrs:{value:e.context.sectionNum,readonly:""}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                  填写人：\n                ")]),a("el-col",{attrs:{span:15}},[a("el-input",{attrs:{value:e.context.fillFormPersonName,readonly:""}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                  审核人：\n                ")]),a("el-col",{attrs:{span:15}},[a("el-select",{attrs:{filterable:""},model:{value:e.context.checkPerson,callback:function(t){e.$set(e.context,"checkPerson",t)},expression:"context.checkPerson"}},e._l(e.employees,function(e,t){return a("el-option",{key:t,attrs:{value:e.EmployeeNum,label:e.EmployeeAlias}})}),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                  辨识时间：\n                ")]),a("el-col",{attrs:{span:15}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss",clearable:""},model:{value:e.context.createTime,callback:function(t){e.$set(e.context,"createTime",t)},expression:"context.createTime"}})],1)],1)],1),a("el-row",{staticStyle:{"text-align":"right","margin-top":"20px"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.editIdent}},[e._v("保 存")]),a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("关 闭")])],1)],1)]),a("div",{staticClass:"section"},[a("el-tree",{ref:"tree",attrs:{"node-key":"id",indent:"0","default-expand-all":!0,"expand-on-click-node":!0,"highlight-current":""},on:{"node-click":e.nodeLeftClickToHide,"node-contextmenu":e.nodeRightClick},scopedSlots:e._u([{key:"default",fn:function(t){t.node;var i=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[e._v(e._s(i.label))])])}}])})],1)])])],1)])},D=[],C={name:"EditDialog",mixins:[m],data:function(){return{editType:"edit"}},methods:{editIdent:function(){var e=this;this.loading=!0,l["c"].putJson(l["a"].SECTION_IDENT+"/ident",this.context,function(t){e.loading=!1,"ok"===t.status?(e.hasChanges=!0,e.$message.success("提交成功！")):e.$message.error("数据传输错误！")})}},created:function(){var e=this;d["a"].$on("show-edit-ident",function(t){e.context.dangerFactorMainID=t.id,e.idList=t.idList,e.visible=!0,e.hasChanges=!1,e.updateDialog(e.context.dangerFactorMainID)})}},_=C,I=Object(g["a"])(_,x,D,!1,null,"c3b15388",null),k=I.exports,N=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"add-dialog fullscreen-dialog"},[a("el-dialog",{attrs:{title:"查看危险有害因素辨识信息",visible:e.visible,modal:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,fullscreen:!0},on:{"update:visible":function(t){e.visible=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dialog-wrapper"},[a("div",{staticClass:"list-filter"},[a("el-row",{staticStyle:{"margin-top":"1em"}},[a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                分公司：\n              ")]),a("el-col",{attrs:{span:15}},[a("el-input",{attrs:{value:e.context.sectionName1,readonly:""}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                班组：\n              ")]),a("el-col",{attrs:{span:15}},[a("el-input",{attrs:{value:e.context.sectionName2,readonly:""}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                岗位单元：\n              ")]),a("el-col",{attrs:{span:15}},[a("el-input",{attrs:{value:e.context.sectionName3,readonly:""}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                唯一性编号：\n              ")]),a("el-col",{attrs:{span:15}},[a("el-input",{attrs:{value:e.context.sectionNum,readonly:""}})],1)],1)],1),a("el-row",{staticStyle:{"margin-top":"1em"}},[a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                填写人：\n              ")]),a("el-col",{attrs:{span:15}},[a("el-input",{attrs:{value:e.context.fillFormPersonName,readonly:""}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                审核人：\n              ")]),a("el-col",{attrs:{span:15}},[a("el-input",{attrs:{value:e.context.checkPersonName,readonly:""}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"filter-label",attrs:{span:7}},[e._v("\n                辨识时间：\n              ")]),a("el-col",{attrs:{span:15}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss",value:e.context.createTime,readonly:""}})],1)],1)],1),a("el-row",{staticStyle:{"text-align":"right","margin-top":"1.5em"}},[a("el-button",{staticStyle:{float:"left"},attrs:{disabled:0===e.idList.indexOf(e.id),type:"primary"},on:{click:function(t){e.updateDialog(e.idList[e.idList.indexOf(e.id)-1])}}},[e._v("上一条")]),a("el-button",{staticStyle:{float:"left"},attrs:{disabled:e.idList.indexOf(e.id)===e.idList.length-1,type:"primary"},on:{click:function(t){e.updateDialog(e.idList[e.idList.indexOf(e.id)+1])}}},[e._v("下一条")]),a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("关 闭")])],1)],1),a("div",{staticClass:"section"},[a("el-tree",{ref:"tree",attrs:{"node-key":"id",indent:"0","default-expand-all":!0,"expand-on-click-node":!0,"highlight-current":""},on:{"node-click":e.nodeLeftClickToHide,"node-contextmenu":e.nodeRightClick},scopedSlots:e._u([{key:"default",fn:function(t){t.node;var i=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[e._v(e._s(i.label))])])}}])})],1)])])],1)])},w=[],$={name:"DetailDialog",mixins:[m],data:function(){return{editType:"detail"}},methods:{getEmployeeName:function(e){var t=this.employees.filter(function(t){return t.EmployeeNum===e});if(t&&t.length>0)return t[0].EmployeeName}},created:function(){var e=this;d["a"].$on("show-detail-ident",function(t){e.context.dangerFactorMainID=t.id,e.idList=t.idList,e.visible=!0,e.updateDialog(e.context.dangerFactorMainID)})}},L=$,T=Object(g["a"])(L,N,w,!1,null,"62f716fa",null),E=T.exports,F=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-dialog-act common-dialog"},[a("el-dialog",{attrs:{title:"添加作业活动的危险有害因素",visible:e.visible,modal:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",attrs:{"label-position":"right",model:e.record,rules:e.rules}},[a("el-form-item",{attrs:{label:"作业活动：",prop:"aeinfoID"}},[a("el-select",{attrs:{value:e.record.aeinfoID,disabled:""}},e._l(e.activityList,function(e,t){return a("el-option",{key:t,attrs:{label:e.AEName,value:e.AEInfoID}})}),1)],1),a("el-form-item",{attrs:{label:"第一类危险源："}},[a("el-input",{attrs:{value:e.record.firstLevelDanger,type:"textarea",readonly:"",autosize:""}})],1),a("el-form-item",{attrs:{label:"第二类危险源：",prop:"dangerFactorName"}},[a("el-input",{attrs:{type:"textarea",autosize:""},model:{value:e.record.dangerFactorName,callback:function(t){e.$set(e.record,"dangerFactorName",t)},expression:"record.dangerFactorName"}})],1),a("el-form-item",{attrs:{label:"事故类型：",prop:"accidentCategory"}},[a("el-select",{attrs:{multiple:""},model:{value:e.record.accidentCategory,callback:function(t){e.$set(e.record,"accidentCategory",t)},expression:"record.accidentCategory"}},e._l(e.accidents,function(e,t){return a("el-option",{key:t,attrs:{label:e.accidentName,value:e.accidentID}})}),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{disabled:e.hasChanges,type:"primary"},on:{click:e.submit}},[e._v("添 加")]),a("el-button",{on:{click:function(t){return e.$refs.ruleForm.resetFields()}}},[e._v("重 置")]),a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("关 闭")])],1)],1)],1)},O=[],S=(a("28a5"),{data:function(){return{rules:{aeinfoID:[{required:!0,message:"不能为空",trigger:"blur"}],dangerFactorName:[{required:!0,message:"不能为空",trigger:"blur"}],accidentCategory:[{required:!0,message:"不能为空",trigger:"blur"},{validator:function(e,t,a){t.length>0?a():a(new Error("不能为空"))},trigger:"blur"}]},record:{aeinfoID:null,dangerFactorName:null,accidentCategory:[],accidentCategorySet:null,workHours:null},activityList:[],loading:!1,hasChanges:!1,visible:!1,idList:[],id:""}},methods:{updateDialog:function(e){var t=this;this.id=e,this.loading=!0,u["c"].get("".concat(u["a"].SECTION_IDENT,"/danger/").concat(this.id)).then(function(e){t.record=e.record,t.record.workHours=Number(t.record.workHours),t.record.accidentCategory=t.record.accidentCategorySet.split(",").map(function(e){return Number(e)}),t.loading=!1})}},computed:Object(s["a"])({},Object(o["b"])(["accidents"]))}),M={name:"AddActDialog",mixins:[S],watch:{visible:function(e){e||(this.hasChanges&&(d["a"].$emit("add-danger-node",{id:"second-"+this.record.actDangerFactorID,label:this.record.dangerFactorName}),this.hasChanges=!1),this.$refs.ruleForm.resetFields())}},methods:{submit:function(){var e=this;this.$refs.ruleForm.validate(function(t){t&&(e.loading=!0,e.record.accidentCategorySet=e.record.accidentCategory.join(","),l["c"].postJson(l["a"].SECTION_IDENT+"/danger",e.record).then(function(t){e.loading=!1,t.id&&(e.record.actDangerFactorID=t.id,e.$message.success("提交成功！"),e.hasChanges=!0,e.visible=!1)}))})}},created:function(){var e=this;d["a"].$on("show-add-act",function(t){e.record.dangerFactorMainID=t.dangerFactorMainID,e.visible=!0,e.activityList=t.activityList,e.record.firstLevelDanger=t.firstLevelDanger,e.record.aeinfoID=t.aeinfoID,e.record.dangerFactorMainID=t.dangerFactorMainID,e.record.actDangerFactorID=null})}},A=M,P=Object(g["a"])(A,F,O,!1,null,"798cc070",null),j=P.exports,R=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-dialog-act common-dialog"},[a("el-dialog",{attrs:{title:"修改作业活动的危险有害因素",visible:e.visible,modal:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",attrs:{"label-position":"right",model:e.record,rules:e.rules}},[a("el-form-item",{attrs:{label:"作业活动：",prop:"aeinfoID"}},[a("el-select",{attrs:{value:e.record.aeinfoID,disabled:""}},e._l(e.activityList,function(e,t){return a("el-option",{key:t,attrs:{label:e.AEName,value:e.AEInfoID}})}),1)],1),a("el-form-item",{attrs:{label:"第一类危险源："}},[a("el-input",{attrs:{value:e.record.firstLevelDanger,type:"textarea",readonly:"",autosize:""}})],1),a("el-form-item",{attrs:{label:"第二类危险源：",prop:"dangerFactorName"}},[a("el-input",{attrs:{type:"textarea",autosize:""},model:{value:e.record.dangerFactorName,callback:function(t){e.$set(e.record,"dangerFactorName",t)},expression:"record.dangerFactorName"}})],1),a("el-form-item",{attrs:{label:"事故类型：",prop:"accidentCategory"}},[a("el-select",{ref:"accidentSelect",attrs:{value:e.record.accidentCategory,multiple:""},on:{change:e.handleAccidentChanged}},e._l(e.accidents,function(e,t){return a("el-option",{key:t,attrs:{label:e.accidentName,value:e.accidentID}})}),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("保 存")]),a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("关 闭")])],1)],1)],1)},H=[],Y={name:"EditActDialog",mixins:[S],watch:{visible:function(e){e||(this.hasChanges&&(d["a"].$emit("edit-danger-node",{label:this.record.dangerFactorName}),this.hasChanges=!1),this.$refs.ruleForm.resetFields())}},methods:{submit:function(){var e=this;this.$refs.ruleForm.validate(function(t){t&&(e.loading=!0,e.record.accidentCategorySet=e.record.accidentCategory.join(","),l["c"].putJson(l["a"].SECTION_IDENT+"/danger",e.record).then(function(t){e.loading=!1,e.$message.success("提交成功！"),e.hasChanges=!0,e.visible=!1}))})},handleAccidentChanged:function(e){this.record.accidentCategory=e,this.$refs.accidentSelect.value=e,this.$refs.accidentSelect.setSelected()}},created:function(){var e=this;d["a"].$on("show-edit-act",function(t){e.record.actDangerFactorID=t.id,e.visible=!0,e.activityList=t.activityList,e.updateDialog(e.record.actDangerFactorID)})}},z=Y,J=Object(g["a"])(z,R,H,!1,null,"cbcc2e4c",null),q=J.exports,U=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-dialog-act common-dialog"},[a("el-dialog",{attrs:{title:"修改作业活动的危险有害因素",visible:e.visible,modal:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",attrs:{"label-position":"right",model:e.record,rules:e.rules}},[a("el-form-item",{attrs:{label:"作业活动：",prop:"aeinfoID"}},[a("el-select",{attrs:{value:e.record.aeinfoID,disabled:""}},e._l(e.activityList,function(e,t){return a("el-option",{key:t,attrs:{label:e.AEName,value:e.AEInfoID}})}),1)],1),a("el-form-item",{attrs:{label:"第一类危险源："}},[a("el-input",{attrs:{value:e.record.firstLevelDanger,type:"textarea",readonly:"",autosize:""}})],1),a("el-form-item",{attrs:{label:"第二类危险源：",prop:"dangerFactorName"}},[a("el-input",{attrs:{type:"textarea",readonly:"",autosize:""},model:{value:e.record.dangerFactorName,callback:function(t){e.$set(e.record,"dangerFactorName",t)},expression:"record.dangerFactorName"}})],1),a("el-form-item",{attrs:{label:"事故类型：",prop:"accidentCategory"}},[a("el-select",{ref:"accidentSelect",attrs:{value:e.record.accidentCategory,multiple:"",disabled:""}},e._l(e.accidents,function(e,t){return a("el-option",{key:t,attrs:{label:e.accidentName,value:e.accidentID}})}),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("关 闭")])],1)],1)],1)},X=[],B={name:"DangerDetail",mixins:[S],watch:{visible:function(e){e||(this.hasChanges&&(d["a"].$emit("edit-danger-node",{label:this.record.aename}),this.hasChanges=!1),this.$refs.ruleForm.resetFields())}},created:function(){var e=this;d["a"].$on("show-detail-act",function(t){e.record.actDangerFactorID=t.id,e.visible=!0,e.activityList=t.activityList,e.updateDialog(e.record.actDangerFactorID)})}},G=B,K=Object(g["a"])(G,U,X,!1,null,"59de7ad3",null),Q=K.exports,V=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.titleText,visible:e.visible,modal:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"label-position":"right"}},[a("el-form-item",{attrs:{label:"第一类危险源名称："}},[a("el-input",{model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{disabled:e.hasChanges,type:"primary"},on:{click:e.submit}},[e._v(e._s(e.submitText))]),a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("关 闭")])],1)],1)},W=[],Z=(a("7f7f"),{name:"Level1DangerDialog",data:function(){return{type:null,node:null,name:null,visible:!1,loading:!1}},watch:{visible:function(e){e||(this.name=null,this.node=null,this.type=null)}},computed:{titleText:function(){switch(this.type){case"add":return"添加第一类危险源";case"edit":return"修改第一类危险源";default:return"添加第一类危险源"}},submitText:function(){switch(this.type){case"add":return"添 加";case"edit":return"保 存";default:return"添 加"}}},methods:{submit:function(){var e=this;if(this.name)switch(this.type){case"add":d["a"].$emit("add-danger-node",{id:"first-".concat(this.node.data.id.substring(this.node.data.id.indexOf("-")+1),"-").concat(this.name),label:this.name}),this.visible=!1;break;case"edit":var t=this.node.parent.data.id;this.loading=!0;var a=function(){d["a"].$emit("edit-danger-node",{id:"first-".concat(t.substring(t.indexOf("-")+1),"-").concat(e.name),label:e.name}),e.loading=!1,e.$message.success("保存成功！"),e.visible=!1};this.node.childNodes&&this.node.childNodes.length>0?Promise.all(this.node.childNodes.map(function(t){return l["c"].putJson(l["a"].SECTION_IDENT+"/danger",{actDangerFactorID:Number(t.data.id.substring(t.data.id.lastIndexOf("-")+1)),firstLevelDanger:e.name})})).then(function(e){a()}):a();break}else this.$message.warning("第一类危险源名称不能为空！")}},created:function(){var e=this;d["a"].$on("show-level1-danger",function(t){var a=t.type,i=t.node;e.type=a,e.node=i,"edit"===a&&(e.name=i.data.label),e.visible=!0})}}),ee=Z,te=(a("a51b"),Object(g["a"])(ee,V,W,!1,null,"1e734eda",null)),ae=te.exports,ie=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"right-click-menu"},[e.visible.activity&&e.userRightEditable?a("div",[a("ul",{staticClass:"el-dropdown-menu el-popper",attrs:{"x-placement":"bottom-end"}},["add"===e.editType||"edit"===e.editType?a("li",{staticClass:"el-dropdown-menu__item operation-editable",attrs:{tabindex:"-1"},on:{click:function(t){return e.handleMenuItemClicked("add-first")}}},[a("i",{staticClass:"el-icon-plus"}),e._v("添加第一类危险源\n      ")]):e._e()])]):e._e(),e.visible.first&&e.userRightEditable?a("div",[a("ul",{staticClass:"el-dropdown-menu el-popper",attrs:{"x-placement":"bottom-end"}},["add"===e.editType||"edit"===e.editType?a("li",{staticClass:"el-dropdown-menu__item operation-editable",attrs:{tabindex:"-1"},on:{click:function(t){return e.handleMenuItemClicked("add-second")}}},[a("i",{staticClass:"el-icon-plus"}),e._v("添加第二类危险源\n      ")]):e._e(),"add"===e.editType||"edit"===e.editType?a("li",{staticClass:"el-dropdown-menu__item operation-editable",attrs:{tabindex:"-1"},on:{click:function(t){return e.handleMenuItemClicked("edit-first")}}},[a("i",{staticClass:"el-icon-edit"}),e._v("修改\n      ")]):e._e(),"add"===e.editType||"edit"===e.editType?a("li",{staticClass:"el-dropdown-menu__item operation-editable",attrs:{tabindex:"-1"},on:{click:function(t){return e.handleMenuItemClicked("delete-first")}}},[a("i",{staticClass:"el-icon-delete"}),e._v("删除\n      ")]):e._e()])]):e._e(),e.visible.second?a("div",[a("ul",{staticClass:"el-dropdown-menu el-popper",attrs:{"x-placement":"bottom-end"}},[a("li",{staticClass:"el-dropdown-menu__item",attrs:{tabindex:"-1"},on:{click:function(t){return e.handleMenuItemClicked("detail-second")}}},[a("i",{staticClass:"el-icon-info"}),e._v("详细\n      ")]),!e.userRightEditable||"add"!==e.editType&&"edit"!==e.editType?e._e():a("li",{staticClass:"el-dropdown-menu__item",attrs:{tabindex:"-1"},on:{click:function(t){return e.handleMenuItemClicked("edit-second")}}},[a("i",{staticClass:"el-icon-edit"}),e._v("修改\n      ")]),!e.userRightEditable||"add"!==e.editType&&"edit"!==e.editType?e._e():a("li",{staticClass:"el-dropdown-menu__item",attrs:{tabindex:"-1"},on:{click:function(t){return e.handleMenuItemClicked("delete-second")}}},[a("i",{staticClass:"el-icon-delete"}),e._v("删除\n      ")])])]):e._e()])},ne=[],se={props:["userRightEditable"],name:"DangerRightClickMenu",data:function(){return{editType:null,visible:{activity:!1,first:!1,second:!1},handleMenuItemClicked:function(){}}},methods:{},created:function(){var e=this;d["a"].$on("show-danger-menu",function(t){e.handleMenuItemClicked=t.handleClick,e.node=t.node,e.editType=t.type,Object.keys(e.visible).forEach(function(t){e.visible[t]=!1}),e.visible[["activity","first","second"][e.node.level-1]]=!0,e.$nextTick(function(){var e=p()(".right-click-menu ul");t.y/Math.max(document.body.scrollHeight,window.outerHeight)<.7?e.css("top",t.y).css("left",t.x):e.css("top",t.y-e[0].offsetHeight).css("left",t.x)})}),d["a"].$on("hide-danger-menu",function(){Object.keys(e.visible).forEach(function(t){e.visible[t]=!1})})}},le=se,oe=(a("c91d"),Object(g["a"])(le,ie,ne,!1,null,"58b85a80",null)),re=oe.exports,ce={name:"App",components:{AddDialog:y,EditDialog:k,DetailDialog:E,AddActDialog:j,EditActDialog:q,DangerDetail:Q,Level1DangerDialog:ae,DangerRightClickMenu:re},data:function(){return{list:[],idList:[],pageNum:0,pageIndex:1,conditions:"",loading:!1,params:[{label:"分公司单元：",type:"select",model:"sectionID1"},{label:"岗位单元：",type:"select",model:"sectionID3"},{label:"岗位编号：",type:"text",model:"sectionNum"},{label:"填写人：",type:"text",model:"FillFormPersonName"},{label:"辨识时间：",type:"time",model:"createdTime"},{label:"是否归档：",type:"select",model:"IsArchived"}],sectionList:[],showArchivedRecords:!1,userRightEditable:!1}},computed:Object(s["a"])({ids:function(){return this.idList.filter(function(e){return e})}},Object(o["b"])(["user"])),methods:{checkAuth:function(e,t){if(l["g"].indexOf(this.user.inst1)>-1)return!0;var a=this.user.inst2;return a?t===this.user.inst1:e===this.user.inst1},filter:function(){this.updateListTable(1,Object(l["e"])(this.params))},handleCheckAll:function(){this.idList=this.ids.length<this.idList.length?this.list.map(function(e){return e.DangerFactorMainID}):this.list.map(function(e){return""})},popMenuMouseEnter:function(e){p()(e.target).find(".popTip").show()},popMenuMouseLeave:function(e){p()(e.target).find(".popTip").hide()},showAddDialog:function(){d["a"].$emit("show-add-ident",{})},showEditDialog:function(e){d["a"].$emit("show-edit-ident",{id:e,idList:this.list.map(function(e){return e.DangerFactorMainID})})},showDetailDialog:function(e){d["a"].$emit("show-detail-ident",{id:e,idList:this.list.map(function(e){return e.DangerFactorMainID})})},updateListTable:function(e,t){var a=this;void 0!==e&&(this.pageIndex=e),void 0!==t&&(this.conditions=t),this.loading=!0,l["c"].post(l["a"].SECTION_IDENT+"/list",{pageIndex:this.pageIndex,conditions:this.conditions},function(e){a.loading=!1,a.list=e.list,a.pageNum=e.pageNum,a.idList=a.list.map(function(e){return""}),a.showArchivedRecords="1"===a.params[5].value})},archiveRecord:function(){var e=this,t=this.list.map(function(e){return e.DangerFactorMainID});0!==this.ids.map(function(e){return t.indexOf(e)}).filter(function(t){return e.checkAuth(e.list[t].sectionInst1,e.list[t].sectionInst2)}).length?this.ids.length>0?this.$confirm("确认归档吗？").then(function(){e.loading=!0,Promise.all(e.ids.map(function(e){return l["c"].put("".concat(l["a"].SECTION_PARTITION,"/section-archive"),{id:e,level:5})})).then(function(t){e.loading=!1,e.$message.success("归档成功！"),d["a"].$emit("ident-list-changed")})}):this.$message.warning("请先选择几条记录再归档。"):this.$message.warning("您没有权限归档选取中的部分纪录！")},deleteRecord:function(){var e=this,t=this.list.map(function(e){return e.DangerFactorMainID});0!==this.ids.map(function(e){return t.indexOf(e)}).filter(function(t){return e.checkAuth(e.list[t].sectionInst1,e.list[t].sectionInst2)}).length?this.ids.length>0?this.$confirm("确认删除吗？").then(function(){e.loading=!0,Promise.all(e.ids.map(function(e){return l["c"].delete("".concat(l["a"].SECTION_PARTITION,"/section-delete"),{id:e,level:5})})).then(function(t){e.loading=!1,e.$message.success("删除成功！"),d["a"].$emit("ident-list-changed")})}):this.$message.warning("请先选择几条记录再删除。"):this.$message.warning("您没有权限删除选取中的部分纪录！")},exportRecord:function(){var e=this;this.params[0].value&&(this.params[0].valueCN=this.sectionList.filter(function(t){return t.sectionID===Number(e.params[0].value)})[0].sectionName),this.params[1].value&&(this.params[1].valueCN=this.sectionList.filter(function(t){return t.sectionID===Number(e.params[1].value)})[0].sectionName),this.params[5].value&&(this.params[5].valueCN=["未归档","已归档"][Number(this.params[5].value)]),l["c"].formSubmit(l["a"].SECTION_IDENT+"/export",{idList:this.ids.join(","),conditions:this.conditions,conditionsCN:Object(l["f"])(this.params)})}},created:function(){var e=this;this.updateListTable(),d["a"].$on("ident-list-changed",function(){e.updateListTable()}),l["c"].get(l["a"].SECTION_IDENT+"/all-section",function(t){e.sectionList=t.list}),this.$store.dispatch("updateUser"),this.$store.dispatch("updateEmployees"),this.$store.dispatch("updateInstitutions"),this.$store.dispatch("updateAccidents"),this.userRightEditable=Object(l["d"])("030200"),console.log(this.userRightEditable)},mounted:function(){},beforeRouteLeave:function(e,t,a){this.$destroy(),a()}},de=ce,ue=(a("4418"),Object(g["a"])(de,i,n,!1,null,"0c8ac254",null));t["default"]=ue.exports},e853:function(e,t,a){var i=a("d3f4"),n=a("1169"),s=a("2b4c")("species");e.exports=function(e){var t;return n(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!n(t.prototype)||(t=void 0),i(t)&&(t=t[s],null===t&&(t=void 0))),void 0===t?Array:t}},ed33:function(e,t,a){a("014b"),e.exports=a("584a").Object.getOwnPropertySymbols},fde4:function(e,t,a){a("bf90");var i=a("584a").Object;e.exports=function(e,t){return i.getOwnPropertyDescriptor(e,t)}},ff3d:function(e,t,a){}}]);